<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Redirecionamento para Araponga.app e Developer Portal." />
  <link rel="canonical" href="https://araponga.app/" />
  <link rel="icon" href="/araponga_icon.png" />
  <title>Araponga</title>
  <style>
    body { font-family: "Inter", system-ui, sans-serif; background: #0b1114; color: #f4f6f7; margin: 0; }
    .container { max-width: 720px; margin: 120px auto; padding: 0 24px; }
    a { color: #7cd1ff; }
  </style>
  <script>
  (function () {
    var LANDING_ORIGIN = 'https://araponga.app';
    var PORTAL_URL = '/devportal/?fromLanding=1';
    var RETURN_PARAM = 'fromLanding';
    var returnFlagKey = 'landingReturnAllowed';
    var redirectFlagKey = 'redirectExecuted';

    var currentUrl = new URL(window.location.href);
    
    // Evitar loops: se já executamos um redirect nesta sessão, não executar novamente
    var redirectExecuted = sessionStorage.getItem(redirectFlagKey) === '1';
    if (redirectExecuted) {
      // Se já redirecionamos, não fazer nada (evita loop infinito)
      return;
    }

    // Se já estamos no devportal, não redirecionar
    if (currentUrl.pathname.startsWith('/devportal')) {
      return;
    }

    var hasReturnFlag = sessionStorage.getItem(returnFlagKey) === '1';

    function isFromLandingReferrer(ref) {
      if (!ref) return false;
      try {
        var refUrl = new URL(ref);
        return refUrl.origin === LANDING_ORIGIN;
      } catch (_) {
        return false;
      }
    }

    // Verificar se vem do landing APENAS pelo referrer (não pelo sessionStorage para evitar loops)
    var fromLanding =
      isFromLandingReferrer(document.referrer) ||
      currentUrl.searchParams.get(RETURN_PARAM) === '1';

    // Marcar que vamos executar um redirect
    sessionStorage.setItem(redirectFlagKey, '1');

    if (fromLanding) {
      sessionStorage.setItem(returnFlagKey, '1');
      window.location.replace(PORTAL_URL);
      return;
    }

    // Redirecionar para landing apenas se não tiver referrer externo
    // Se tiver referrer externo (como Gamma), não redirecionar para evitar loops
    var hasExternalReferrer = document.referrer && 
      !document.referrer.startsWith(window.location.origin) &&
      !isFromLandingReferrer(document.referrer);
    
    if (!hasExternalReferrer) {
      sessionStorage.setItem(returnFlagKey, '1');
      window.location.replace(LANDING_ORIGIN + '/');
    }
    // Se tem referrer externo, não redirecionar (deixa o usuário ver a página)
  })();
</script>
</head>
<body>
  <main class="container">
    <h1>Araponga API</h1>
    <p>Redirecionando para o aplicativo principal e o Developer Portal.</p>
    <p>
      Se o redirecionamento não acontecer, acesse
      <a href="https://araponga.app">araponga.app</a> ou
      <a href="/devportal/">Developer Portal</a>.
    </p>
  </main>
</body>
</html>
